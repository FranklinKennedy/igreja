# Inicia o motor de reescrita de URL
RewriteEngine On

# DEFINE O CAMINHO BASE PARA AS REGRAS DENTRO DESTA PASTA
RewriteBase /igreja/

# Impede que os usuários vejam a lista de arquivos de um diretório
Options -Indexes

# ----------------------------------------------------------------------
# REGRAS PARA URLS AMIGÁVEIS (REMOVER .PHP)
# ----------------------------------------------------------------------

# 1. Redireciona requisições que incluem ".php" para a versão sem a extensão
RewriteCond %{THE_REQUEST} \s/+(.+?)\.php[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# 2. Reescreve internamente a URL amigável para o arquivo .php correspondente
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.*)$ $1.php [L]


# ----------------------------------------------------------------------
# SEGURANÇA: Prevenção de Acesso Direto e Configurações
# ----------------------------------------------------------------------

# Bloqueia o acesso direto a arquivos de configuração sensíveis
<Files "db_connect.php">
    Order allow,deny
    Deny from all
</Files>
<Files "session_config.php">
    Order allow,deny
    Deny from all
</Files>

# Protege o próprio arquivo .htaccess
<Files ".htaccess">
    Order allow,deny
    Deny from all
</Files>

# ----------------------------------------------------------------------
# MELHORIAS: Forçar HTTPS e WWW (Descomente se tiver SSL)
# ----------------------------------------------------------------------
# Se o seu site roda em https://www.seusite.com
#
# RewriteCond %{HTTPS} off 
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
#
# RewriteCond %{HTTP_HOST} !^www\.
# RewriteRule ^(.*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ----------------------------------------------------------------------
# MELHORIAS: Cabeçalhos de Segurança HTTP
# ----------------------------------------------------------------------
<IfModule mod_headers.c>
    # Impede que o site seja carregado dentro de um iframe em outros sites (Clickjacking)
    Header always set X-Frame-Options "SAMEORIGIN"
    # Protege contra ataques XSS
    Header set X-XSS-Protection "1; mode=block"
    # Impede que o navegador "adivinhe" o tipo de conteúdo de um arquivo
    Header set X-Content-Type-Options "nosniff"
    # Política de Referência: só envia o cabeçalho Referer para a mesma origem
    Header set Referrer-Policy "same-origin"
</IfModule>
# ----------------------------------------------------------------------
# MELHORIAS: Ativar Cache do Navegador
# ----------------------------------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access 1 year"
  ExpiresByType image/jpeg "access 1 year"
  ExpiresByType image/gif "access 1 year"
  ExpiresByType image/png "access 1 year"
  ExpiresByType image/webp "access 1 year"
  ExpiresByType text/css "access 1 month"
  ExpiresByType application/pdf "access 1 month"
  ExpiresByType application/javascript "access 1 month"
  ExpiresByType application/x-javascript "access 1 month"
  ExpiresByType image/x-icon "access 1 year"
  ExpiresDefault "access 2 days"
</IfModule>
# ----------------------------------------------------------------------